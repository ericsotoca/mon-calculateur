<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Carbone - Pr√©cision Expert</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•ó</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        .fade-in { animation: fadeIn .6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #10b981; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>

    <!-- CHARGEMENT LIBRAIRIES -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.3/Recharts.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.10/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-800">
    
    <div id="root" class="flex flex-col items-center justify-center min-h-screen">
        <div class="flex flex-col items-center space-y-4 p-6 bg-white rounded-xl shadow-lg" id="loading-screen">
            <div class="loader"></div>
            <div class="text-lg font-semibold text-gray-600">Chargement...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const RechartsLib = window.Recharts || null;
        const { PieChart, Pie, Cell, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = RechartsLib || {};

        /* --- ICONS --- */
        const IconLeaf = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>;
        const IconCar = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>;
        const IconHome = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const IconWifi = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 20h.01"/><path d="M2 8.82a15 15 0 0 1 20 0"/><path d="M5 12.859a10 10 0 0 1 14 0"/><path d="M8.5 16.429a5 5 0 0 1 7 0"/></svg>;
        const IconBulb = () => <svg className="w-8 h-8 text-yellow-500 mb-2" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>;
        const IconReset = () => <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;

        /* --- CONSTANTES --- */
        const EMISSION_FACTORS = {
            alimentation: { 
                rouge: { val: 5.0, unit: 'kg CO2e/repas', desc: 'B≈ìuf, Agneau (impact fort)' },
                blanche: { val: 1.5, unit: 'kg CO2e/repas', desc: 'Poulet, Porc, Poisson (impact moyen)' },
                vegetarien: { val: 1.2, unit: 'kg CO2e/repas', desc: '≈íufs, Fromage (impact faible)' },
                vegan: { val: 0.9, unit: 'kg CO2e/repas', desc: '100% V√©g√©tal' },
                jeune: { val: 0.0, unit: 'kg CO2e/repas', desc: 'Je√ªne / Repas saut√©' }
            },
            transport: { 
                voiture: { val: 0.192, unit: 'kg CO2e/km', desc: 'Moyenne parc thermique' },
                bus: { val: 0.105, unit: 'kg CO2e/km', desc: 'Moyenne urbain/r√©gional' },
                train: { val: 0.041, unit: 'kg CO2e/km', desc: 'Mix TGV/TER France' },
                avionCourt: { val: 0.258, unit: 'kg CO2e/km', desc: 'Vol < 1000 km' },
                avionMoyen: { val: 0.187, unit: 'kg CO2e/km', desc: 'Vol 1000-3500 km' },
                avionLong: { val: 0.152, unit: 'kg CO2e/km', desc: 'Vol > 3500 km' }
            },
            logement: { 
                electricite: { val: 0.053, unit: 'kg CO2e/kWh', desc: 'Mix √©lectrique fran√ßais' },
                gaz: { val: 0.206, unit: 'kg CO2e/kWh', desc: 'Chauffage gaz naturel' },
                fioul: { val: 0.324, unit: 'kg CO2e/kWh', desc: 'Chauffage fioul domestique' },
                bois: { val: 0.030, unit: 'kg CO2e/kWh', desc: 'Granul√©s/B√ªches' }
            },
            numerique: { 
                donnees: { val: 0.06, unit: 'kg CO2e/Go', desc: 'R√©seau + Data Center' },
                streaming: { val: 0.06, unit: 'kg CO2e/h', desc: 'Visionnage HD' }
            }
        };
        
        const MOY_FR = 9400;
        const COLORS = ['#10b981', '#3b82f6', '#f97316', '#a855f7'];
        const TRANSPORT_VIEW_MULT = { semaine: 52, mois: 12, an: 1 };

        const VALEURS_MOYENNES = {
            repasRouge: '4', repasBlanc: '6', repasVegetarien: '4', repasVegan: '0', repasJeune: '0',
            voiture: '7500', bus: '0', train: '2000', avionCourt: '0', avionMoyen: '0', avionLong: '0',
            electricite: '200', gaz: '100', fioul: '0', bois: '0', donnees: '50', streaming: '2'
        };

        function CarbonCalculator() {
            useEffect(() => { const l = document.getElementById('loading-screen'); if(l) l.style.display = 'none'; }, []);

            const [formData, setFormData] = useState(() => {
                try { return { ...VALEURS_MOYENNES, ...JSON.parse(localStorage.getItem('carbonForm')) }; } catch { return VALEURS_MOYENNES; }
            });
            const [results, setResults] = useState(null);
            const [detailRows, setDetailRows] = useState([]);
            const [adviceData, setAdviceData] = useState(null);
            const [history, setHistory] = useState(() => {
                try { return JSON.parse(localStorage.getItem('carbonHistory')) || []; } catch { return []; }
            });
            const [transportView, setTransportView] = useState('an');
            const [showCoefs, setShowCoefs] = useState(false);

            useEffect(() => { localStorage.setItem('carbonForm', JSON.stringify(formData)); }, [formData]);
            const handleChange = e => setFormData({ ...formData, [e.target.name]: e.target.value });

            // Conversion instantan√©e
            const switchTransportView = (newView) => {
                const ratio = TRANSPORT_VIEW_MULT[transportView] / TRANSPORT_VIEW_MULT[newView];
                const newFormData = { ...formData };
                ['voiture', 'bus', 'train'].forEach(k => {
                    const val = parseFloat(formData[k]);
                    if (!isNaN(val) && val > 0) newFormData[k] = Math.round(val * ratio);
                });
                setFormData(newFormData);
                setTransportView(newView);
            };

            const calculate = () => {
                let total = 0;
                let breakdown = [];
                let catTotals = { alimentation: 0, transport: 0, logement: 0, numerique: 0 };

                const addRow = (cat, label, input, freqMult, factorData, unit) => {
                    const val = parseFloat(input) || 0;
                    if (val > 0 || label === 'Je√ªne') {
                        const subTotal = val * freqMult * factorData.val;
                        total += subTotal;
                        catTotals[cat] += subTotal;
                        breakdown.push({ 
                            cat, label, 
                            formula: `${val} ${unit} √ó ${freqMult} √ó ${factorData.val}`, 
                            subTotal: Math.round(subTotal),
                            rawVal: val // utile pour l'analyse des conseils
                        });
                    }
                };

                // --- CALCUL ALIMENTATION DISTINCT ---
                addRow('alimentation', 'Viande Rouge (B≈ìuf/Agneau)', formData.repasRouge, 52, EMISSION_FACTORS.alimentation.rouge, 'repas');
                addRow('alimentation', 'Viande Blanche (Poulet/Porc)', formData.repasBlanc, 52, EMISSION_FACTORS.alimentation.blanche, 'repas');
                addRow('alimentation', 'V√©g√©tarien', formData.repasVegetarien, 52, EMISSION_FACTORS.alimentation.vegetarien, 'repas');
                addRow('alimentation', 'V√©g√©talien', formData.repasVegan, 52, EMISSION_FACTORS.alimentation.vegan, 'repas');

                const tMult = TRANSPORT_VIEW_MULT[transportView];
                addRow('transport', 'Voiture', formData.voiture, tMult, EMISSION_FACTORS.transport.voiture, transportView);
                addRow('transport', 'Bus', formData.bus, tMult, EMISSION_FACTORS.transport.bus, transportView);
                addRow('transport', 'Train', formData.train, tMult, EMISSION_FACTORS.transport.train, transportView);
                
                addRow('transport', 'Avion Court', formData.avionCourt, 1, EMISSION_FACTORS.transport.avionCourt, 'km');
                addRow('transport', 'Avion Moyen', formData.avionMoyen, 1, EMISSION_FACTORS.transport.avionMoyen, 'km');
                addRow('transport', 'Avion Long', formData.avionLong, 1, EMISSION_FACTORS.transport.avionLong, 'km');

                addRow('logement', '√âlectricit√©', formData.electricite, 12, EMISSION_FACTORS.logement.electricite, 'kWh');
                addRow('logement', 'Gaz', formData.gaz, 12, EMISSION_FACTORS.logement.gaz, 'kWh');
                addRow('logement', 'Fioul', formData.fioul, 12, EMISSION_FACTORS.logement.fioul, 'kWh');
                addRow('logement', 'Bois', formData.bois, 12, EMISSION_FACTORS.logement.bois, 'kWh');
                addRow('numerique', 'Donn√©es', formData.donnees, 12, EMISSION_FACTORS.numerique.donnees, 'Go');
                addRow('numerique', 'Streaming', formData.streaming, 365, EMISSION_FACTORS.numerique.streaming, 'h');

                // TRI
                breakdown.sort((a, b) => b.subTotal - a.subTotal);

                // --- GENERATION CONSEILS INTELLIGENTS ---
                const score = Math.round(total);
                let encouragement = "";
                let tip = "";

                if (score < 2000) encouragement = "Excellent ! Vous √™tes un exemple, objectif 2050 atteint. üèÜ";
                else if (score < MOY_FR) encouragement = "Bravo, vous √™tes mieux que la moyenne fran√ßaise ! üå±";
                else encouragement = "Courage ! Quelques ajustements cibl√©s feront baisser ce chiffre. üí™";

                if (breakdown.length > 0) {
                    const topItem = breakdown[0];
                    
                    // Logique sp√©cifique alimentation
                    if (topItem.label.includes('Viande Rouge')) {
                        tip = "La viande rouge est votre poste N¬∞1. La remplacer par de la volaille divise son impact par 3, et par du v√©g√©tal par 5.";
                    } else if (topItem.label.includes('Viande Blanche')) {
                        // Cas sp√©cifique : mange d√©j√† que du poulet
                        if ((parseFloat(formData.repasRouge)||0) === 0) {
                            tip = "Bravo, vous √©vitez d√©j√† la viande rouge ! Pour r√©duire encore ce poste, essayez d'introduire plus de repas v√©g√©tariens (l√©gumineuses, ≈ìufs).";
                        } else {
                            tip = "La viande blanche est votre poste principal. Essayez d'alterner avec des repas sans viande.";
                        }
                    } else if (topItem.label.includes('Voiture')) {
                        tip = "La voiture p√®se lourd. T√©l√©travail, v√©lo ou covoiturage sont les leviers les plus puissants ici.";
                    } else if (topItem.label.includes('Avion')) {
                        tip = "L'avion domine votre bilan. Privil√©gier le train pour l'Europe r√©duit drastiquement l'empreinte.";
                    } else if (topItem.cat === 'logement') {
                        tip = "Le logement est votre poste principal. Baisser le chauffage de 1¬∞C r√©duit la consommation de 7%.";
                    } else {
                        tip = `Votre poste principal est ${topItem.label}. Essayez de r√©duire cette consommation de 10% pour commencer.`;
                    }
                }

                setAdviceData({ title: encouragement, text: tip });
                const res = { ...catTotals, total: score, tonnes: (total / 1000).toFixed(2), date: new Date().toISOString() };
                setResults(res);
                setDetailRows(breakdown);
                setHistory([...history, res].slice(-10));
                localStorage.setItem('carbonHistory', JSON.stringify([...history, res].slice(-10)));
                setTimeout(() => { document.getElementById('results-section')?.scrollIntoView({ behavior: 'smooth' }); }, 100);
            };

            const reset = () => { if(confirm("Tout effacer ?")) { setFormData(VALEURS_MOYENNES); setResults(null); localStorage.removeItem('carbonForm'); } };

            const pieData = results ? [
                { name: 'Alim', value: results.alimentation }, { name: 'Trans', value: results.transport }, 
                { name: 'Log', value: results.logement }, { name: 'Num', value: results.numerique }
            ] : [];

            const repasTotal = (parseFloat(formData.repasRouge)||0) + (parseFloat(formData.repasBlanc)||0) + (parseFloat(formData.repasVegetarien)||0) + (parseFloat(formData.repasVegan)||0) + (parseFloat(formData.repasJeune)||0);

            return (
                <div className="max-w-5xl mx-auto p-4 md:p-8 fade-in pb-20">
                    <header className="text-center mb-10">
                        <div className="flex justify-center items-center text-green-600 mb-2"><IconLeaf /><h1 className="text-3xl md:text-4xl font-bold ml-2">Calculateur Carbone</h1></div>
                        <p className="text-slate-500">Pr√©cision Expert : Viande rouge vs blanche, avion d√©taill√©...</p>
                    </header>

                    <div className="grid md:grid-cols-2 gap-6 mb-8">
                        {/* ALIMENTATION ETENDUE */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-t-green-500">
                            <h2 className="text-lg font-bold mb-2 flex items-center text-slate-700"><IconLeaf /><span className="ml-2">Alimentation</span></h2>
                            <p className="text-xs text-slate-500 mb-4">Repas par semaine (Total : <span className="font-bold text-green-600">{repasTotal}</span>)</p>
                            <div className="space-y-3">
                                <div className="flex justify-between items-center">
                                    <label className="text-sm text-red-700 font-medium">Viande Rouge (B≈ìuf/Agneau)</label>
                                    <input type="number" min="0" name="repasRouge" value={formData.repasRouge} onChange={handleChange} className="w-20 p-2 bg-red-50 border border-red-200 rounded-lg text-center" />
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-sm text-yellow-700 font-medium">Viande Blanche (Poulet/Porc)</label>
                                    <input type="number" min="0" name="repasBlanc" value={formData.repasBlanc} onChange={handleChange} className="w-20 p-2 bg-yellow-50 border border-yellow-200 rounded-lg text-center" />
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-sm text-green-700">V√©g√©tarien (Oeuf/Fromage)</label>
                                    <input type="number" min="0" name="repasVegetarien" value={formData.repasVegetarien} onChange={handleChange} className="w-20 p-2 bg-green-50 border border-green-200 rounded-lg text-center" />
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-sm text-green-600">V√©g√©talien (100% V√©g√©tal)</label>
                                    <input type="number" min="0" name="repasVegan" value={formData.repasVegan} onChange={handleChange} className="w-20 p-2 bg-green-50 border border-green-200 rounded-lg text-center" />
                                </div>
                                <div className="flex justify-between items-center">
                                    <label className="text-sm text-slate-400">Je√ªne / Saut√©</label>
                                    <input type="number" min="0" name="repasJeune" value={formData.repasJeune} onChange={handleChange} className="w-20 p-2 bg-slate-50 border rounded-lg text-center" />
                                </div>
                            </div>
                        </div>

                        {/* TRANSPORT */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-t-blue-500">
                            <div className="flex justify-between items-center mb-2"><h2 className="text-lg font-bold flex items-center text-slate-700"><IconCar /><span className="ml-2">Transport</span></h2>
                            <div className="bg-slate-100 p-1 rounded flex text-xs">{['semaine', 'mois', 'an'].map(v => <button key={v} onClick={() => switchTransportView(v)} className={`px-2 py-1 rounded capitalize ${transportView === v ? 'bg-white shadow text-blue-600 font-bold' : 'text-slate-500'}`}>{v}</button>)}</div></div>
                            <p className="text-xs text-slate-500 mb-2 mt-1 font-bold">Terrestre (vue : {transportView})</p>
                            <div className="space-y-2 mb-4">
                                {['voiture', 'bus', 'train'].map(m => (
                                    <div key={m} className="flex justify-between items-center"><label className="capitalize text-sm text-slate-600 w-24">{m}</label><input type="number" min="0" name={m} value={formData[m]} onChange={handleChange} className="w-full p-2 bg-slate-50 border rounded-lg" /></div>
                                ))}
                            </div>
                            <p className="text-xs text-slate-500 mb-2 font-bold border-t pt-2">A√©rien (km/an fixe)</p>
                            <div className="space-y-2">
                                {[{k:'avionCourt', l:'Court (<1k)'}, {k:'avionMoyen', l:'Moyen (1-3k)'}, {k:'avionLong', l:'Long (>3.5k)'}].map(av => (
                                    <div key={av.k} className="flex justify-between items-center"><label className="text-sm text-slate-600 w-32">{av.l}</label><input type="number" min="0" name={av.k} value={formData[av.k]} onChange={handleChange} className="w-full p-2 bg-slate-50 border rounded-lg" placeholder="km" /></div>
                                ))}
                            </div>
                        </div>

                        {/* LOGEMENT */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-t-orange-500">
                            <h2 className="text-lg font-bold mb-2 flex items-center text-slate-700"><IconHome /><span className="ml-2">Logement</span></h2>
                            <p className="text-xs text-slate-500 mb-4">Conso. mensuelle (kWh)</p>
                            <div className="grid grid-cols-2 gap-4">
                                {['electricite', 'gaz', 'fioul', 'bois'].map(k => <div key={k}><label className="text-xs font-bold uppercase text-slate-400 block mb-1">{k}</label><input type="number" min="0" name={k} value={formData[k]} onChange={handleChange} className="w-full p-2 bg-slate-50 border rounded-lg" /></div>)}
                            </div>
                        </div>

                        {/* NUMERIQUE */}
                        <div className="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-t-purple-500">
                            <h2 className="text-lg font-bold mb-2 flex items-center text-slate-700"><IconWifi /><span className="ml-2">Num√©rique</span></h2>
                            <div className="space-y-4">
                                <div><label className="block text-sm mb-1 text-slate-600">Donn√©es (Go/mois)</label><input type="number" min="0" name="donnees" value={formData.donnees} onChange={handleChange} className="w-full p-2 bg-slate-50 border rounded-lg" /></div>
                                <div><label className="block text-sm mb-1 text-slate-600">Streaming (h/jour)</label><input type="number" min="0" step="0.5" name="streaming" value={formData.streaming} onChange={handleChange} className="w-full p-2 bg-slate-50 border rounded-lg" /></div>
                            </div>
                        </div>
                    </div>

                    <div className="text-center mb-12 space-y-4">
                        <button onClick={calculate} className="bg-slate-800 text-white px-10 py-3 rounded-xl text-lg font-bold hover:bg-slate-900 transition shadow-lg hover:scale-105 transform">Calculer</button>
                        <div className="flex justify-center gap-6"><button onClick={reset} className="text-slate-400 text-sm hover:text-slate-700 flex items-center"><IconReset /> R√©initialiser</button></div>
                    </div>

                    {results && (
                        <div id="results-section" className="fade-in space-y-8 pb-12">
                            {/* SCORE */}
                            <div className="bg-white p-8 rounded-3xl shadow-lg border border-slate-100 text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div>
                                <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-blue-600">{results.tonnes}</div>
                                <div className="text-xl font-bold text-slate-400 mb-4">tonnes CO‚ÇÇe / an</div>
                                <div className="inline-block bg-slate-100 px-4 py-2 rounded-full text-sm">Moyenne FR : <strong>{(MOY_FR/1000).toFixed(1)} t</strong></div>
                            </div>

                            {/* GRAPHIQUES */}
                            {RechartsLib && (
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border h-80">
                                        <h3 className="text-center font-bold text-slate-700 mb-2">R√©partition</h3>
                                        <ResponsiveContainer><PieChart><Pie data={pieData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} dataKey="value" paddingAngle={5}>{pieData.map((e, i) => <Cell key={i} fill={COLORS[i % COLORS.length]} />)}</Pie><Tooltip formatter={v => `${Math.round(v)} kg`} /><Legend /></PieChart></ResponsiveContainer>
                                    </div>
                                    {history.length > 0 && (
                                        <div className="bg-white p-6 rounded-2xl shadow-sm border h-80">
                                            <h3 className="text-center font-bold text-slate-700 mb-2">Historique</h3>
                                            <ResponsiveContainer><LineChart data={history}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="date" tickFormatter={d => new Date(d).getDate() + '/' + (new Date(d).getMonth()+1)} /><YAxis /><Tooltip labelFormatter={l => new Date(l).toLocaleString()} /><Line type="monotone" dataKey="total" stroke="#8b5cf6" strokeWidth={3} dot={{r:4}} /></LineChart></ResponsiveContainer>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* TABLEAU */}
                            <div className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-slate-200">
                                <h3 className="text-2xl font-bold mb-6 text-center text-slate-700">D√©tails (Tri√©s par impact)</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-50 text-slate-500 uppercase font-bold">
                                            <tr><th className="px-4 py-3">Poste</th><th className="px-4 py-3">Calcul</th><th className="px-4 py-3 text-right">Total (kg)</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {detailRows.map((row, idx) => (
                                                <tr key={idx} className={`hover:bg-slate-50 ${idx === 0 ? 'bg-red-50' : ''}`}>
                                                    <td className="px-4 py-3 font-semibold text-slate-600 flex items-center">
                                                        {idx === 0 && <span className="text-xs bg-red-200 text-red-800 px-1.5 py-0.5 rounded mr-2">N¬∞1</span>}
                                                        {row.label}
                                                    </td>
                                                    <td className="px-4 py-3 font-mono text-slate-500 text-xs">{row.formula}</td>
                                                    <td className="px-4 py-3 text-right font-bold">{row.subTotal.toLocaleString()}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                        <tfoot className="bg-slate-50 font-bold text-slate-800"><tr><td colSpan="2" className="px-4 py-4 text-right uppercase">Total</td><td className="px-4 py-4 text-right text-lg text-blue-600">{results.total.toLocaleString()} kg</td></tr></tfoot>
                                    </table>
                                </div>
                            </div>

                            {/* CONSEIL PERSO */}
                            {adviceData && (
                                <div className="bg-blue-50 border border-blue-100 p-8 rounded-3xl text-center shadow-inner">
                                    <IconBulb />
                                    <h4 className="text-xl font-bold text-blue-800 mb-2">Analyse & Conseil</h4>
                                    <p className="text-blue-900 font-semibold text-lg mb-4">{adviceData.title}</p>
                                    <div className="bg-white p-4 rounded-xl shadow-sm max-w-2xl mx-auto text-slate-600">
                                        <span className="font-bold text-blue-600">Priorit√© :</span> {adviceData.text}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* FOOTER */}
                    <div className="mt-16 border-t border-slate-200 pt-8 text-center">
                        <button onClick={() => setShowCoefs(!showCoefs)} className="text-slate-500 hover:text-slate-800 text-sm font-semibold transition mb-4">
                            {showCoefs ? 'Masquer' : 'Voir'} les coefficients
                            <span className={`ml-2 inline-block transform transition ${showCoefs ? 'rotate-180' : ''}`}>‚ñº</span>
                        </button>
                        {showCoefs && (
                            <div className="mb-6 overflow-x-auto bg-white rounded-xl shadow p-6 fade-in text-left">
                                <table className="w-full text-sm border-collapse">
                                    <thead><tr className="border-b-2 border-slate-100 text-slate-500"><th className="py-2">√âl√©ment</th><th className="py-2">Valeur</th><th className="py-2">Description</th></tr></thead>
                                    <tbody className="divide-y divide-slate-100">{Object.values(EMISSION_FACTORS).map(cat => Object.entries(cat).map(([k, d]) => <tr key={k} className="hover:bg-slate-50"><td className="py-2 font-medium capitalize">{k}</td><td className="py-2 font-mono text-blue-600">{d.val} {d.unit}</td><td className="py-2 text-slate-500 italic">{d.desc}</td></tr>))}</tbody>
                                </table>
                            </div>
                        )}
                        <div className="text-xs text-slate-400 mt-4">
                            Source : <a href="https://base-empreinte.ademe.fr/donnees/jeu-donnees" target="_blank" rel="noopener noreferrer" className="underline hover:text-green-600 font-bold transition-colors">Base Empreinte ADEME</a>.
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CarbonCalculator />);
    </script>
</body>
</html>
