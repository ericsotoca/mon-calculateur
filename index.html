<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Carbone - Intelligent</title>
    
    <!-- 1. STYLE : Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. DEPENDANCES : CLOUDFLARE -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.3/Recharts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.10/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-transition { transition: all 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">

    <div id="root" class="flex flex-col items-center justify-center min-h-screen">
        <div class="text-2xl font-semibold text-gray-600 animate-pulse">Chargement de l'application...</div>
    </div>

    <script type="text/babel">
        if (!window.React || !window.Recharts) { throw new Error("Librairies manquantes"); }

        const { useState, useEffect } = React;
        const { PieChart, Pie, Cell, BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        // --- ICONES ---
        const IconLeaf = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>;
        const IconCar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>;
        const IconHome = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const IconWifi = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M12 20h.01"/><path d="M2 8.82a15 15 0 0 1 20 0"/><path d="M5 12.859a10 10 0 0 1 14 0"/><path d="M8.5 16.429a5 5 0 0 1 7 0"/></svg>;
        const IconReset = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 mr-2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 ml-2"><path d="m6 9 6 6 6-6"/></svg>;
        const IconStar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6 text-yellow-500"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;

        // --- CONSTANTES ---
        const EMISSION_FACTORS = {
            alimentation: { omnivore: { factor: 3 }, vegetarien: { factor: 1.7 }, vegan: { factor: 1.5 } },
            transport: { voiture: { factor: 0.192 }, bus: { factor: 0.105 }, train: { factor: 0.041 }, avion: { factor: 0.255 } },
            logement: { electricite: { factor: 0.053 }, gaz: { factor: 0.206 }, fioul: { factor: 0.267 }, bois: { factor: 0.025 } },
            numerique: { donnees: { factor: 0.06 }, streaming: { factor: 0.05 } }
        };

        const MOYENNE_FRANCAISE = { total: 9400 };
        const COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6'];
        const VALEURS_MOYENNES = { 
            repasOmnivore: '14', repasVegetarien: '5', repasVegan: '2', 
            voiture: '100', bus: '20', train: '10', avion: '0', 
            electricite: '200', gaz: '100', fioul: '0', bois: '0', 
            donnees: '50', streaming: '2' 
        };

        function CarbonCalculator() {
            const [formData, setFormData] = useState(VALEURS_MOYENNES);
            const [results, setResults] = useState(null);
            const [history, setHistory] = useState([]);
            const [transportView, setTransportView] = useState('semaine');
            const [showSources, setShowSources] = useState(false);
            const [bestAction, setBestAction] = useState(null);

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('carbonHistory');
                    if (saved) setHistory(JSON.parse(saved));
                } catch(e) {}
            }, []);

            const handleChange = (e) => setFormData({...formData, [e.target.name]: e.target.value});
            
            // --- 1. FONCTION DE CHANGEMENT DE VUE TRANSPORT INTELLIGENTE ---
            const switchTransportView = (newView) => {
                if (newView === transportView) return;

                // Facteurs de conversion vers l'Année
                const toAnnual = { semaine: 52, mois: 12, an: 1 };
                // Facteurs de conversion depuis l'Année vers la nouvelle vue
                const fromAnnual = { semaine: 1/52, mois: 1/12, an: 1 };

                // Ratio direct
                const ratio = toAnnual[transportView] * fromAnnual[newView];

                // Mise à jour des valeurs
                setFormData(prev => ({
                    ...prev,
                    voiture: Math.round(prev.voiture * ratio),
                    bus: Math.round(prev.bus * ratio),
                    train: Math.round(prev.train * ratio),
                    avion: Math.round(prev.avion * ratio)
                }));

                setTransportView(newView);
            };

            const convertTransportToAnnual = (val) => {
                const v = parseFloat(val) || 0;
                if (transportView === 'semaine') return v * 52;
                if (transportView === 'mois') return v * 12;
                return v;
            };

            const calculateBestAction = (data, totals) => {
                const actions = [];
                
                // 1. Action Viande : Si on remplace 50% de la viande par du végétarien
                const meatMeals = parseFloat(data.repasOmnivore) || 0;
                if (meatMeals > 3) {
                    const mealsToSwitch = Math.floor(meatMeals / 2); // 50%
                    const currentImpact = mealsToSwitch * EMISSION_FACTORS.alimentation.omnivore.factor * 365;
                    const newImpact = mealsToSwitch * EMISSION_FACTORS.alimentation.vegetarien.factor * 365;
                    actions.push({
                        title: "Adopter un régime flexitarien",
                        desc: `Remplacer ${mealsToSwitch} repas avec viande par du végétarien chaque semaine.`,
                        save: currentImpact - newImpact,
                        icon: <IconLeaf />
                    });
                }

                // 2. Action Avion : Réduire de moitié
                const avionKm = convertTransportToAnnual(data.avion);
                if (avionKm > 1000) {
                    const savedKm = avionKm / 2;
                    actions.push({
                        title: "Réduire l'avion",
                        desc: "Réduire vos vols de moitié ou privilégier le train pour l'Europe.",
                        save: savedKm * EMISSION_FACTORS.transport.avion.factor,
                        icon: <IconCar />
                    });
                }

                // 3. Action Chauffage : -10% (Isolation ou baisse thermostat)
                const heatingTotal = totals.logement; // Approximatif
                if (heatingTotal > 500) {
                    actions.push({
                        title: "Isolation & Chauffage",
                        desc: "Baisser le chauffage de 1°C ou améliorer l'isolation (-10%).",
                        save: heatingTotal * 0.10,
                        icon: <IconHome />
                    });
                }

                // Trier par impact (le plus grand gain en premier)
                actions.sort((a, b) => b.save - a.save);

                return actions.length > 0 ? actions[0] : null;
            };

            const calculate = () => {
                // Alim
                const vOmni = (parseFloat(formData.repasOmnivore)||0) * EMISSION_FACTORS.alimentation.omnivore.factor * 365;
                const vVege = (parseFloat(formData.repasVegetarien)||0) * EMISSION_FACTORS.alimentation.vegetarien.factor * 365;
                const vVegan = (parseFloat(formData.repasVegan)||0) * EMISSION_FACTORS.alimentation.vegan.factor * 365;
                const totalAlim = vOmni + vVege + vVegan;

                // Transp
                const vVoit = convertTransportToAnnual(formData.voiture) * EMISSION_FACTORS.transport.voiture.factor;
                const vBus = convertTransportToAnnual(formData.bus) * EMISSION_FACTORS.transport.bus.factor;
                const vTrain = convertTransportToAnnual(formData.train) * EMISSION_FACTORS.transport.train.factor;
                const vAvion = convertTransportToAnnual(formData.avion) * EMISSION_FACTORS.transport.avion.factor;
                const totalTrans = vVoit + vBus + vTrain + vAvion;

                // Logement
                const vElec = (parseFloat(formData.electricite)||0) * EMISSION_FACTORS.logement.electricite.factor * 12;
                const vGaz = (parseFloat(formData.gaz)||0) * EMISSION_FACTORS.logement.gaz.factor * 12;
                const vFioul = (parseFloat(formData.fioul)||0) * EMISSION_FACTORS.logement.fioul.factor * 12;
                const vBois = (parseFloat(formData.bois)||0) * EMISSION_FACTORS.logement.bois.factor * 12;
                const totalLog = vElec + vGaz + vFioul + vBois;

                // Numérique
                const vDonnees = (parseFloat(formData.donnees)||0) * EMISSION_FACTORS.numerique.donnees.factor * 12;
                const vStream = (parseFloat(formData.streaming)||0) * EMISSION_FACTORS.numerique.streaming.factor * 365;
                const totalNum = vDonnees + vStream;

                const grandTotal = totalAlim + totalTrans + totalLog + totalNum;

                // --- 2. CALCUL DE LA MEILLEURE ACTION ---
                const best = calculateBestAction(formData, {logement: totalLog});
                setBestAction(best);

                const res = {
                    alimentation: Math.round(totalAlim),
                    transport: Math.round(totalTrans),
                    logement: Math.round(totalLog),
                    numerique: Math.round(totalNum),
                    total: Math.round(grandTotal),
                    tonnes: (grandTotal/1000).toFixed(2),
                    date: new Date().toISOString(),
                    details: [
                        { category: "Alimentation", icon: <IconLeaf />, color: "text-green-600", items: [
                            { label: "Omnivore", val: vOmni }, { label: "Végétarien", val: vVege }, { label: "Végan", val: vVegan }
                        ]},
                        { category: "Transport", icon: <IconCar />, color: "text-blue-600", items: [
                            { label: "Voiture", val: vVoit }, { label: "Bus", val: vBus }, { label: "Train", val: vTrain }, { label: "Avion", val: vAvion }
                        ]},
                        { category: "Logement", icon: <IconHome />, color: "text-orange-600", items: [
                            { label: "Électricité", val: vElec }, { label: "Gaz", val: vGaz }, { label: "Fioul", val: vFioul }, { label: "Bois", val: vBois }
                        ]},
                        { category: "Numérique", icon: <IconWifi />, color: "text-purple-600", items: [
                            { label: "Données", val: vDonnees }, { label: "Streaming", val: vStream }
                        ]}
                    ]
                };

                setResults(res);
                const newHistory = [...history, res].slice(-10);
                setHistory(newHistory);
                localStorage.setItem('carbonHistory', JSON.stringify(newHistory));
            };

            const reset = () => {
                setFormData(VALEURS_MOYENNES);
                setTransportView('semaine');
                setResults(null);
                setBestAction(null);
            };

            const pieData = results ? [
                {name: 'Alim', value: results.alimentation},
                {name: 'Transp', value: results.transport},
                {name: 'Logement', value: results.logement},
                {name: 'Num', value: results.numerique}
            ] : [];

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8 fade-in pb-20">
                    <header className="text-center mb-10">
                        <div className="flex justify-center items-center text-green-600 mb-2">
                            <IconLeaf />
                            <h1 className="text-3xl font-bold ml-2 text-gray-800">Calculateur Carbone</h1>
                        </div>
                        <p className="text-gray-600">Estimez votre impact annuel (kg CO₂e)</p>
                    </header>

                    <div className="grid md:grid-cols-2 gap-6 mb-8">
                        {/* ALIMENTATION */}
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-green-500">
                            <h2 className="text-lg font-bold mb-4 flex items-center"><IconLeaf /> <span className="ml-2">Alimentation</span></h2>
                            <p className="text-xs text-gray-500 uppercase font-bold mb-3">Repas par semaine</p>
                            <div className="space-y-3">
                                {['repasOmnivore', 'repasVegetarien', 'repasVegan'].map(name => (
                                    <div key={name} className="flex justify-between items-center">
                                        <label className="capitalize text-sm">{name.replace('repas', '')}</label>
                                        <input type="number" name={name} value={formData[name]} onChange={handleChange} className="w-20 p-2 border rounded focus:ring-2 focus:ring-green-500 outline-none" />
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* TRANSPORT INTELLIGENT */}
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                                <h2 className="text-lg font-bold flex items-center"><IconCar /> <span className="ml-2">Transport</span></h2>
                                <div className="bg-gray-100 p-1 rounded-lg flex text-xs font-semibold">
                                    {['semaine', 'mois', 'an'].map((view) => (
                                        <button 
                                            key={view} 
                                            onClick={() => switchTransportView(view)} 
                                            className={`px-3 py-1.5 rounded-md capitalize tab-transition ${transportView === view ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                                        >
                                            {view}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <p className="text-xs text-gray-500 uppercase font-bold mb-3">Distance par <span className="text-blue-600">{transportView}</span> (convertie auto.)</p>
                            <div className="space-y-3">
                                {['voiture', 'bus', 'train', 'avion'].map(m => (
                                    <div key={m} className="flex justify-between items-center">
                                        <label className="capitalize text-sm w-24">{m}</label>
                                        <div className="relative flex-1">
                                            <input type="number" name={m} value={formData[m]} onChange={handleChange} className="w-full p-2 pr-10 border rounded focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="0" />
                                            <span className="absolute right-3 top-2 text-xs text-gray-400">km</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* LOGEMENT */}
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-orange-500">
                            <h2 className="text-lg font-bold mb-4 flex items-center"><IconHome /> <span className="ml-2">Logement (kWh/mois)</span></h2>
                            <div className="grid grid-cols-2 gap-4">
                                {['electricite', 'gaz', 'fioul', 'bois'].map(k => (
                                    <div key={k}>
                                        <label className="text-xs font-bold uppercase text-gray-500 block mb-1">{k}</label>
                                        <input type="number" name={k} value={formData[k]} onChange={handleChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-orange-500 outline-none" />
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* NUMERIQUE */}
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-purple-500">
                            <h2 className="text-lg font-bold mb-4 flex items-center"><IconWifi /> <span className="ml-2">Numérique</span></h2>
                            <div className="space-y-4">
                                <div><label className="block text-sm mb-1">Données (Go/mois)</label><input type="number" name="donnees" value={formData.donnees} onChange={handleChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" /></div>
                                <div><label className="block text-sm mb-1">Streaming (h/jour)</label><input type="number" name="streaming" value={formData.streaming} onChange={handleChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-purple-500 outline-none" /></div>
                            </div>
                        </div>
                    </div>

                    <div className="text-center mb-10">
                        <button onClick={calculate} className="bg-gray-800 text-white px-8 py-3 rounded-lg text-lg font-bold hover:bg-black transition shadow-lg transform hover:scale-105">Calculer mon empreinte</button>
                        <button onClick={reset} className="block mt-4 text-gray-500 text-sm hover:text-black mx-auto flex items-center"><IconReset /> Réinitialiser</button>
                    </div>

                    {results && (
                        <div className="fade-in space-y-8 pb-12">
                            <div className="bg-white p-8 rounded-2xl shadow-xl text-center">
                                <h2 className="text-2xl font-bold text-gray-700">Résultat Annuel</h2>
                                <div className="text-6xl font-extrabold text-green-600 my-2">{results.tonnes}</div>
                                <div className="text-xl text-gray-500">tonnes de CO₂e</div>
                                <div className="mt-4 inline-block bg-gray-100 px-4 py-2 rounded-full text-sm">Moyenne Française : <strong>{MOYENNE_FRANCAISE.total/1000} tonnes</strong></div>
                            </div>

                            {/* --- NOUVEAU : CARTE DE L'ACTION À FORT IMPACT --- */}
                            {bestAction && (
                                <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-[1.01] transition-all">
                                    <div className="flex flex-col md:flex-row items-center justify-between">
                                        <div className="flex items-center mb-4 md:mb-0">
                                            <div className="p-3 bg-white/20 rounded-full mr-4">
                                                <IconStar />
                                            </div>
                                            <div>
                                                <h3 className="text-xl font-bold mb-1">L'action qui changerait tout pour vous</h3>
                                                <p className="text-blue-100 max-w-xl">{bestAction.desc}</p>
                                            </div>
                                        </div>
                                        <div className="text-center bg-white/10 p-4 rounded-lg backdrop-blur-sm min-w-[150px]">
                                            <div className="text-sm text-blue-100 uppercase font-semibold">Gain estimé</div>
                                            <div className="text-3xl font-bold text-white">-{Math.round(bestAction.save)} <span className="text-lg">kg</span></div>
                                            <div className="text-xs text-blue-200">de CO₂e / an</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="bg-white p-4 rounded-xl shadow-lg h-80">
                                    <h3 className="text-center font-bold mb-2">Répartition</h3>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie data={pieData} cx="50%" cy="50%" outerRadius={80} fill="#8884d8" dataKey="value" label>
                                                {pieData.map((e, i) => <Cell key={i} fill={COLORS[i % COLORS.length]} />)}
                                            </Pie>
                                            <Tooltip formatter={(val) => Math.round(val) + " kg"} />
                                            <Legend />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                                {history.length > 1 && (
                                    <div className="bg-white p-4 rounded-xl shadow-lg h-80">
                                        <h3 className="text-center font-bold mb-2">Historique</h3>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={history}>
                                                <CartesianGrid strokeDasharray="3 3" />
                                                <XAxis dataKey="date" tickFormatter={(d)=>new Date(d).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} />
                                                <YAxis />
                                                <Tooltip labelFormatter={(l)=>new Date(l).toLocaleString()} />
                                                <Line type="monotone" dataKey="total" stroke="#8b5cf6" strokeWidth={2} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}
                            </div>

                            <div className="bg-white p-6 rounded-xl shadow-lg">
                                <h3 className="text-2xl font-bold text-gray-800 mb-6 text-center">Détail des émissions (kg CO₂e / an)</h3>
                                <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {results.details.map((cat, idx) => (
                                        <div key={idx} className="border border-gray-100 rounded-xl p-4 bg-gray-50 hover:shadow-md transition">
                                            <div className={`flex items-center mb-3 pb-2 border-b border-gray-200 ${cat.color}`}>
                                                {cat.icon}
                                                <h4 className="font-bold ml-2 text-lg">{cat.category}</h4>
                                            </div>
                                            <ul className="space-y-3">
                                                {cat.items.map((item, i) => (
                                                    <li key={i} className="flex justify-between items-center text-sm">
                                                        <span className="text-gray-600">{item.label}</span>
                                                        <span className="font-semibold bg-white px-2 py-1 rounded shadow-sm">
                                                            {Math.round(item.val).toLocaleString()}
                                                        </span>
                                                    </li>
                                                ))}
                                                <li className="flex justify-between items-center pt-3 mt-2 border-t border-gray-200 font-bold text-gray-800">
                                                    <span>Total</span>
                                                    <span>{Math.round(cat.items.reduce((acc, curr) => acc + curr.val, 0)).toLocaleString()} kg</span>
                                                </li>
                                            </ul>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="mt-12 text-center max-w-4xl mx-auto">
                        <button 
                            onClick={() => setShowSources(!showSources)}
                            className="inline-flex items-center text-gray-500 hover:text-gray-800 transition font-medium text-sm border px-4 py-2 rounded-full hover:bg-gray-100"
                        >
                            <IconInfo /> 
                            Comprendre le calcul (Facteurs d'émission)
                            <div className={`transform transition-transform duration-200 ${showSources ? 'rotate-180' : ''}`}>
                                <IconChevronDown />
                            </div>
                        </button>

                        {showSources && (
                            <div className="mt-6 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 text-left animate-fade-in">
                                <div className="p-4 bg-gray-50 border-b border-gray-100">
                                    <h3 className="font-bold text-gray-800">Méthodologie utilisée</h3>
                                    <p className="text-sm text-gray-500">
                                        Les facteurs d'émission ci-dessous sont utilisés pour convertir vos données (km, repas, kWh) en équivalent CO₂ (kg CO₂e).
                                    </p>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm text-gray-700">
                                        <thead className="bg-gray-50 text-gray-600 uppercase text-xs font-semibold">
                                            <tr>
                                                <th className="px-6 py-3 text-left">Catégorie</th>
                                                <th className="px-6 py-3 text-left">Sous-catégorie</th>
                                                <th className="px-6 py-3 text-left">Facteur (kg CO₂e)</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3 font-medium text-green-600">Alimentation</td><td>Repas omnivore</td><td>3.0</td></tr>
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3"></td><td>Repas végétarien</td><td>1.7</td></tr>
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3"></td><td>Repas végan</td><td>1.5</td></tr>
                                            
                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3 font-medium text-blue-600">Transport</td><td>Voiture (par km)</td><td>0.192</td></tr>
                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3"></td><td>Bus (par km)</td><td>0.105</td></tr>
                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3"></td><td>Train (par km)</td><td>0.041</td></tr>
                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3"></td><td>Avion (par km)</td><td>0.255</td></tr>

                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3 font-medium text-orange-600">Logement</td><td>Électricité (par kWh)</td><td>0.053</td></tr>
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3"></td><td>Gaz (par kWh)</td><td>0.206</td></tr>
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3"></td><td>Fioul (par kWh)</td><td>0.267</td></tr>
                                            <tr className="hover:bg-gray-50"><td className="px-6 py-3"></td><td>Bois (par kWh)</td><td>0.025</td></tr>

                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3 font-medium text-purple-600">Numérique</td><td>Données (par Go)</td><td>0.06</td></tr>
                                            <tr className="hover:bg-gray-50 bg-slate-50/50"><td className="px-6 py-3"></td><td>Streaming (par heure)</td><td>0.05</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CarbonCalculator />);
    </script>
</body>
</html>
